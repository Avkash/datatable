# Windows 7 and 10 build
build: false

skip_branch_with_pr: true

environment:
  LLVM6: C:\\Program Files\\LLVM
  PATH: "%LLVM6%/bin;%PATH%"
  APPVEYOR_SAVE_CACHE_ON_ERROR: true
  matrix:
    - PYTHON: "C:\\Python35"
      PYTHON_VERSION: "3.5"
      PYTHON_ARCH: "64"
      DISTRIBUTIONS: "sdist bdist_wheel"

    - PYTHON: "C:\\Python36"
      PYTHON_VERSION: "3.6"
      PYTHON_ARCH: "64"
      DISTRIBUTIONS: "sdist bdist_wheel"

init:
  - "ECHO %PYTHON% %PYTHON_VERSION% %PYTHON_ARCH%"
  - "ECHO %LLVM6%"

install:
  - choco install mingw
  - choco install llvm
  - choco install make
  #- set LLVM_CONFIG=/Program Files/LLVM/bin
  # - llvm-config --version
  #- llvm-config --host-target
  - "%PYTHON%/Scripts/pip.exe install setuptools"
  - "%PYTHON%/Scripts/pip.exe install python-dateutil"
  - "%PYTHON%/Scripts/pip.exe install numpy"
  - "%PYTHON%/Scripts/pip.exe install colorama"
  - "%PYTHON%/Scripts/pip.exe install typesentry"
  - "%PYTHON%/Scripts/pip.exe install blessed"
  - "%PYTHON%/Scripts/pip.exe install llvmlite"
  - "%PYTHON%/Scripts/pip.exe install pandas"
  - "%PYTHON%/Scripts/pip.exe install pytest"
  - "%PYTHON%/Scripts/pip.exe install virtualenv"
  - "%PYTHON%/Scripts/pip.exe install wheel"

cache:
  - /ProgramData/chocolatey/bin -> appveyor.yml
  - /ProgramData/chocolatey/lib -> appveyor.yml
  - '%LOCALAPPDATA%/pip/Cache'

test_script:
  # Apparently, 'dir' does not understand forward-slash paths...
  - dir C:\ProgramData\chocolatey\lib\make\tools\bin\
  - dir C:\ProgramData\
  - dir "C:\Program Files\"
  - dir "C:\Program Files\LLVM\"
  - dir "C:\Program Files\LLVM\bin\"
  - dir %PYTHON%\
  # - /ProgramData/chocolatey/lib/make/tools/bin/make.exe test_install PYTHON=%PYTHON%/python.exe
  - "%PYTHON%/python.exe -m pip install .[testing] --no-cache-dir"
  - /ProgramData/chocolatey/lib/make/tools/bin/make.exe PYTHON=%PYTHON%/python.exe

artifacts:
  - path: dist/*
