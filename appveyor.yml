# DO NOT CHANGE the "init" and "install" sections below

# Download script file from GitHub
init:
  ps: |
        $ErrorActionPreference = "Stop"
        Invoke-WebRequest http://raw.github.com/krlmlr/r-appveyor/master/scripts/appveyor-tool.ps1 -OutFile "..\appveyor-tool.ps1"
        Import-Module '..\appveyor-tool.ps1'
install:   # this is needed.  Don't remove it. Don't know what it does, though.  It is not Bootstrap CSS it seems.
  ps: Bootstrap
  - "ECHO %PYTHON% %PYTHON_VERSION% %PYTHON_ARCH%"
  - "ECHO %LLVM6%"

skip_branch_with_pr: true

environment:
  global:
    GCC_PATH: mingw_64
  LLVM6: C:\\Program Files\\LLVM
  PATH: "%LLVM6%/bin;%PATH%"
  APPVEYOR_SAVE_CACHE_ON_ERROR: true
  matrix:
    - PYTHON: "C:\\Python35"
      PYTHON_VERSION: "3.5"
      PYTHON_ARCH: "64"
      DISTRIBUTIONS: "sdist bdist_wheel"

    - PYTHON: "C:\\Python36"
      PYTHON_VERSION: "3.6"
      PYTHON_ARCH: "64"
      DISTRIBUTIONS: "sdist bdist_wheel"

install:
  - choco install mingw
  - choco install llvm
  - choco install make
  #- set LLVM_CONFIG=/Program Files/LLVM/bin
  # - llvm-config --version
  #- llvm-config --host-target
  - "%PYTHON%/Scripts/pip.exe install setuptools"
  - "%PYTHON%/Scripts/pip.exe install python-dateutil"
  - "%PYTHON%/Scripts/pip.exe install numpy"
  - "%PYTHON%/Scripts/pip.exe install colorama"
  - "%PYTHON%/Scripts/pip.exe install typesentry"
  - "%PYTHON%/Scripts/pip.exe install blessed"
  - "%PYTHON%/Scripts/pip.exe install llvmlite"
  - "%PYTHON%/Scripts/pip.exe install pandas"
  - "%PYTHON%/Scripts/pip.exe install pytest"
  - "%PYTHON%/Scripts/pip.exe install virtualenv"
  - "%PYTHON%/Scripts/pip.exe install wheel"

cache:
  - /ProgramData/chocolatey/bin -> appveyor.yml
  - /ProgramData/chocolatey/lib -> appveyor.yml
  - '%LOCALAPPDATA%/pip/Cache'

test_script:
  # Apparently, 'dir' does not understand forward-slash paths...
  - dir C:\ProgramData\chocolatey\lib\make\tools\bin\
  - dir C:\ProgramData\
  - dir "C:\Program Files\"
  - dir "C:\Program Files\LLVM\"
  - dir "C:\Program Files\LLVM\bin\"
  - dir "C:\Program Files\LLVM\lib\"
  - dir "C:\Program Files\LLVM\lib\clang\"
  - dir "C:\Program Files\LLVM\include\"
  - dir "C:\Program Files\LLVM\libexec\"
  - dir "C:\Program Files\LLVM\share\"
  - dir %PYTHON%\
  # - /ProgramData/chocolatey/lib/make/tools/bin/make.exe test_install PYTHON=%PYTHON%/python.exe
  - "%PYTHON%/python.exe -m pip install .[testing] --no-cache-dir"
  - /ProgramData/chocolatey/lib/make/tools/bin/make.exe PYTHON=%PYTHON%/python.exe

artifacts:
  - path: dist/*
